@model OrderViewModel
@using techZone.Utilities

@{
    ViewData["Title"] = "Order Details";
}

<div class="container mt-4">
    <h3 class="mb-4">Order Details</h3>

    <form asp-action="UpdateOrderDetails" method="post">
        @Html.AntiForgeryToken()
        <input asp-for="OrderHeader.Id" type="hidden" />

        <!-- Order Info -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Order Information</h5>
            </div>
            <div class="card-body">
                <p><strong>Order Id:</strong> @Model.OrderHeader.Id</p>
                <p><strong>Order Date:</strong> @Model.OrderHeader.OrderDate.ToString("dd/MM/yyyy")</p>

                <div class="mb-2">
                    <label asp-for="OrderHeader.ShippingDate" class="form-label fw-bold"></label>
                    <input asp-for="OrderHeader.ShippingDate" type="date" class="form-control" />
                </div>

                <div class="mb-3">
                    <label asp-for="OrderHeader.OrderStatus" class="form-label fw-semibold text-primary">
                        Order Status
                    </label>
                    <select asp-for="OrderHeader.OrderStatus" class="form-select shadow-sm rounded-3 border-primary">
                        <option disabled selected>-- Select Status --</option>
                        <option value="Pending">⏳ @SD.Pending</option>
                        <option value="Approve">✅ @SD.Approve</option>
                        <option value="Processing">⚙️ @SD.Processing</option>
                        <option value="Shipped">📦 @SD.Shipped</option>
                        <option value="Refund">💸 @SD.Refund</option>
                        <option value="Cancelled">🚫 @SD.Cancelled</option>
                        <option value="Rejected">❌ @SD.Rejected</option>
                    </select>
                    <span asp-validation-for="OrderHeader.OrderStatus" class="text-danger small"></span>
                </div>

                <div class="mb-2">
                    <label asp-for="OrderHeader.Carrier" class="form-label fw-bold"></label>
                    <input asp-for="OrderHeader.Carrier" class="form-control" />
                </div>

                <div class="mb-2">
                    <label asp-for="OrderHeader.TrackingNumber" class="form-label fw-bold"></label>
                    <input asp-for="OrderHeader.TrackingNumber" class="form-control" />
                </div>

                <p><strong>Total:</strong> @Model.OrderHeader.TotalPrice.ToString("C")</p>
            </div>
        </div>

        <!-- Customer Info -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Customer Information</h5>
            </div>
            <div class="card-body">
                <p><strong>Name:</strong> @Model.OrderHeader.ApplicationUser.Name</p>
                <p><strong>Email:</strong> @Model.OrderHeader.ApplicationUser.Email</p>
                <p><strong>Phone:</strong> @Model.OrderHeader.ApplicationUser.PhoneNumber</p>
                <p><strong>City:</strong> @Model.OrderHeader.City</p>
                <p><strong>Address:</strong> @Model.OrderHeader.ApplicationUser.Address</p>
            </div>
        </div>

        <!-- Payment Info -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Payment Information</h5>
            </div>
            <div class="card-body">
                <p><strong>Payment Status:</strong> @Model.OrderHeader.PaymentStatus</p>
                <p><strong>Payment Date:</strong> @Model.OrderHeader.PaymentDate.ToString("dd/MM/yyyy")</p>
                <p><strong>Session Id:</strong> @Model.OrderHeader.SessionId</p>
                <p><strong>Payment Intent Id:</strong> @(string.IsNullOrEmpty(Model.OrderHeader.PaymentIntentId) ? "N/A" : Model.OrderHeader.PaymentIntentId)</p>
            </div>
        </div>

        <!-- Order Details (Products) -->
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Products</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-bordered table-sm text-center mb-0">
                    <thead style="background-color:#000; color:#fff;">
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Count</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.OrderDetails)
                        {
                            <tr>
                                <td>@item.Product.Name</td>
                                <td>@item.Price.ToString("C")</td>
                                <td>@item.Count</td>
                                <td>@((item.Price * item.Count).ToString("C"))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="mt-3 text-center bg-black text-white p-3 rounded shadow">
                <h5>
                    Total:
                    <span class="text-success fw-bold">
                        @Model.OrderDetails.Sum(x => x.Price * x.Count).ToString("C")
                    </span>
                </h5>
            </div>
        </div>

        <div class="mt-3 d-flex justify-content-between">
            <a asp-action="Index" class="btn btn-secondary">Back to Orders</a>
            <button type="submit" class="btn btn-primary">Update Order</button>
        </div>
    </form>
</div>
